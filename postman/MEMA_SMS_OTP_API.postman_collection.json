{
  "info": {
    "name": "MADAMOVE - SMS & OTP API",
    "description": "Collection pour tester les endpoints SMS et OTP avec Twilio",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "testPhone",
      "value": "+33123456789",
      "type": "string"
    },
    {
      "key": "chauffeurToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "clientToken",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üì± Chauffeurs SMS/OTP",
      "item": [
        {
          "name": "1. Inscription chauffeur via SMS",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Dupont\",\n  \"prenom\": \"Jean\",\n  \"telephone\": \"{{testPhone}}\",\n  \"statut\": \"SALARIE\",\n  \"email\": \"jean.dupont@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chauffeurs/register-sms",
              "host": ["{{baseUrl}}"],
              "path": ["chauffeurs", "register-sms"]
            }
          }
        },
        {
          "name": "2. Demander OTP chauffeur",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chauffeurs/send-otp",
              "host": ["{{baseUrl}}"],
              "path": ["chauffeurs", "send-otp"]
            }
          }
        },
        {
          "name": "3. V√©rifier OTP et connexion chauffeur",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chauffeurs/verify-otp",
              "host": ["{{baseUrl}}"],
              "path": ["chauffeurs", "verify-otp"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (responseCode.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('chauffeurToken', response.token);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "4. Connexion directe chauffeur SMS",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chauffeurs/login-sms",
              "host": ["{{baseUrl}}"],
              "path": ["chauffeurs", "login-sms"]
            }
          }
        },
        {
          "name": "5. Renvoyer OTP chauffeur",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chauffeurs/resend-otp",
              "host": ["{{baseUrl}}"],
              "path": ["chauffeurs", "resend-otp"]
            }
          }
        },
        {
          "name": "6. SMS personnalis√© chauffeur",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{chauffeurToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": [\"{{testPhone}}\", \"+33987654321\"],\n  \"message\": \"Votre course est confirm√©e. Le chauffeur arrivera dans 5 minutes.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chauffeurs/send-custom-sms",
              "host": ["{{baseUrl}}"],
              "path": ["chauffeurs", "send-custom-sms"]
            }
          }
        }
      ]
    },
    {
      "name": "üë§ Clients SMS/OTP",
      "item": [
        {
          "name": "1. Inscription client via SMS",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Martin\",\n  \"prenom\": \"Sophie\",\n  \"telephone\": \"{{testPhone}}\",\n  \"email\": \"sophie.martin@example.com\",\n  \"adresse\": \"123 Rue de Paris\",\n  \"ville\": \"Paris\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/register-sms",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "register-sms"]
            }
          }
        },
        {
          "name": "2. Demander OTP client",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/send-otp",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "send-otp"]
            }
          }
        },
        {
          "name": "3. V√©rifier OTP et connexion client",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/verify-otp",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "verify-otp"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (responseCode.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('clientToken', response.token);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "4. Connexion directe client SMS",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/login-sms",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "login-sms"]
            }
          }
        },
        {
          "name": "5. Renvoyer OTP client",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"telephone\": \"{{testPhone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/resend-otp",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "resend-otp"]
            }
          }
        },
        {
          "name": "6. SMS personnalis√© client",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{clientToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": [\"{{testPhone}}\"],\n  \"message\": \"Votre r√©servation est confirm√©e. Merci de votre confiance !\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/send-custom-sms",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "send-custom-sms"]
            }
          }
        }
      ]
    },
    {
      "name": "üì≤ SMS G√©n√©rique",
      "item": [
        {
          "name": "1. Envoyer SMS personnalis√©",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{chauffeurToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": [\"{{testPhone}}\", \"+33987654321\"],\n  \"message\": \"Message personnalis√© depuis l'API SMS MEMA\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sms/send",
              "host": ["{{baseUrl}}"],
              "path": ["sms", "send"]
            }
          }
        },
        {
          "name": "2. Envoyer OTP g√©n√©rique",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{chauffeurToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phoneNumber\": \"{{testPhone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sms/send-otp",
              "host": ["{{baseUrl}}"],
              "path": ["sms", "send-otp"]
            }
          }
        },
        {
          "name": "3. V√©rifier OTP g√©n√©rique",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{chauffeurToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phoneNumber\": \"{{testPhone}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sms/verify-otp",
              "host": ["{{baseUrl}}"],
              "path": ["sms", "verify-otp"]
            }
          }
        },
        {
          "name": "4. Renvoyer OTP g√©n√©rique",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{chauffeurToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phoneNumber\": \"{{testPhone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sms/resend-otp",
              "host": ["{{baseUrl}}"],
              "path": ["sms", "resend-otp"]
            }
          }
        }
      ]
    }
  ]
}
